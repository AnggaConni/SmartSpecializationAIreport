<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3 Builder - Strategic Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: { 700: '#1e3a5f', 800: '#162e4d', 900: '#0f172a' },
                        terracotta: { 500: '#e07a5f', 600: '#c56b3e' },
                        sage: { 100: '#e6f4ea', 600: '#1e8e3e' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }

        // --- AI ENGINE ---
        const AI_BRIDGE = {
            models: ['gemini-2.5-flash', 'gemini-2.0-flash-exp'],
            hasKey: (key) => !!key && key.length > 10,
            async generate(prompt, apiKey, onProgress) {
                const cleanKey = apiKey ? apiKey.trim() : "";
                if (!this.hasKey(cleanKey)) throw new Error("API Key Invalid / Kosong");
                
                for (const model of this.models) {
                    try {
                        if (onProgress) onProgress(`Thinking (${model})...`);
                        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${cleanKey}`;
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });
                        if (!response.ok) throw new Error("Gagal menghubungi Google AI. Cek Quota/Key.");
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
                    } catch (e) {
                        if (model === this.models[this.models.length-1]) throw e;
                    }
                }
            }
        };
    </script>

    <style>
        .report-paper { background: white; box-shadow: 0 0 15px rgba(0,0,0,0.05); min-height: 800px; }
        .accordion-content { transition: max-height 0.3s ease-in-out; overflow: hidden; }
        
        /* Print Styles */
        /* Print Styles - UPDATED */
        @media print { 
            /* 1. Sembunyikan elemen pengganggu */
            .no-print, button, input, textarea, select { display: none !important; } 
            
            /* 2. Reset Layout Halaman */
            body, html, #root { 
                background: white; 
                width: 100%; 
                height: 100%; 
                margin: 0; 
                padding: 0; 
                overflow: visible !important; /* PENTING: Matikan scroll */
            }

            /* 3. Atur Kertas Laporan agar Dominan */
            .report-paper { 
                box-shadow: none !important; 
                border: none !important; 
                width: 100% !important; 
                max-width: 100% !important; /* Paksa lebar penuh */
                padding: 0 !important; 
                margin: 0 !important;
                position: absolute;
                top: 0;
                left: 0;
            } 

            /* 4. Trik agar Diagram/Paragraf tidak terpotong di tengah halaman */
            .page-break-avoid { 
                page-break-inside: avoid !important; 
                break-inside: avoid !important;
                display: block; /* Kadang perlu ini agar browser patuh */
            }
            
            .page-break { page-break-before: always; }
        }

        /* Tooltip Enhanced */
        .tooltip-container { position: relative; display: inline-flex; align-items: center; margin-left: 6px; }
        .tooltip-icon { width: 16px; height: 16px; background: #cbd5e1; color: #475569; border-radius: 50%; font-size: 10px; font-weight: bold; cursor: help; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
        .tooltip-icon:hover { background: #1e3a5f; color: white; }
        .tooltip-text { visibility: hidden; width: 220px; background-color: #1e3a5f; color: #fff; text-align: left; border-radius: 6px; padding: 10px; position: absolute; z-index: 50; bottom: 140%; left: 50%; transform: translateX(-50%); opacity: 0; transition: all 0.2s; font-size: 11px; line-height: 1.4; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); pointer-events: none; }
        .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #1e3a5f transparent transparent transparent; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; bottom: 130%; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- HELP REGISTRY (EXPANDED wording) ---
        const HELP_REGISTRY = {
            // General
            regionName: "Identitas wilayah analisis (Provinsi/Kab/Kota).",
            vision: "Gambaran masa depan ekonomi yang ingin dicapai dalam 5-10 tahun.",
            timeline: "Periode pelaksanaan strategi (misal: 2025-2030).",
            // Sectors
            localVal: "Output/PDRB sektor ini di wilayah Anda (dalam Miliar Rupiah).",
            nationalVal: "Output sektor yang sama di tingkat Nasional (Benchmark untuk LQ).",
            workers: "Jumlah tenaga kerja yang terserap di sektor ini.",
            exportVal: "Nilai ekspor produk sektor ini ke luar wilayah/negeri.",
            rationale: "Alasan kualitatif mengapa sektor ini strategis (mis: budaya, SDA unik).",
            // SWOT
            strength: "Faktor internal positif (SDA melimpah, SDM terampil).",
            weakness: "Faktor internal negatif (Infrastruktur buruk, kurang modal).",
            opportunity: "Faktor eksternal positif (Tren pasar global, kebijakan pusat).",
            threat: "Faktor eksternal negatif (Bencana alam, persaingan harga).",
            // Helix
            helixName: "Nama Lembaga/Organisasi/Tokoh.",
            helixRole: "Peran dalam S3 (Pemerintah, Akademisi, Bisnis, Komunitas).",
            // Action
            actionActivity: "Program konkret yang akan dijalankan.",
            actionOutput: "Target terukur dari kegiatan tersebut.",
            actionBudget: "Estimasi biaya yang dibutuhkan.",
            // Finance
            publicInv: "Total investasi dari pemerintah/publik (USD Million).",
            privateInv: "Total investasi dari Swasta/FDI (USD Million).",
            fundingNeeded: "Total kebutuhan dana untuk mencapai Visi (USD Million).",
            divIndex: "Indeks Diversifikasi (0-100). Semakin tinggi, sumber dana makin bervariasi (tidak hanya bergantung pada APBD).",
            blendedReady: "Kesiapan institusi untuk skema Blended Finance/KPBU (0-100).",
            // Equity
            giniImpact: "Estimasi dampak strategi terhadap Rasio Gini. Angka minus (mis: -0.02) berarti baik (mengurangi ketimpangan).",
            genderInc: "Indeks Inklusi Gender (0-100%). Rasio keterlibatan perempuan dalam ekosistem.",
            smePart: "Persentase pelibatan UMKM lokal dalam rantai pasok industri prioritas.",
            ruralShare: "Porsi investasi/program yang langsung berdampak pada masyarakat pedesaan.",
            youthMult: "Efek pengganda (multiplier) untuk penyerapan tenaga kerja usia muda/milenial.",
            // Environment
            climateVuln: "Indeks Kerentanan Iklim (0-100). Makin tinggi angkanya, daerah tersebut makin rentan terhadap krisis cuaca/bencana alam.",
            carbonInt: "Intensitas Karbon (Ton CO2 ekuivalen per USD 1 Juta output). Semakin kecil angkanya, industrinya semakin hijau.",
            waterRisk: "Risiko ketergantungan sektor terhadap pasokan air bersih (0-100). Penting untuk daerah rawan kekeringan.",
            bioRisk: "Risiko operasional/ekspansi industri merusak keanekaragaman hayati lokal (0-100).",
            // Monitoring & KPI
            kpiType: "Output = Hasil langsung kegiatan. Outcome = Manfaat yang dirasakan. Impact = Dampak luas/makro.",
            baseline: "Kondisi awal sebelum strategi dijalankan (Tahun & Nilai).",
            target: "Target akhir yang dijanjikan dalam dokumen strategi (Tahun & Nilai).",
            
            // Institutional Capacity
            coordIndex: "Skor 0-100: Seberapa solid koordinasi antar dinas (Ego-sektoral rendah = skor tinggi).",
            policyCoh: "Skor 0-100: Keselarasan kebijakan pusat dan daerah.",
            pppReady: "Skor 0-100: Kesiapan pemda menerima skema Public-Private Partnership (KPBU).",
            budgetAbs: "Skor 0-100: Kapasitas serapan anggaran APBD setiap tahun.",
            signerName: "Nama Pejabat yang akan tanda tangan di halaman terakhir dokumen.",
            
            // Advanced Sector Metrics
            rnd: "Persentase dari PDRB atau omzet yang diinvestasikan kembali untuk Riset & Pengembangan.",
            collab: "Jumlah kerjasama resmi yang aktif antara industri ini dengan Universitas/Lembaga Riset.",
            patents: "Jumlah hak kekayaan intelektual (Paten, Merek, Indikator Geografis) yang terdaftar.",
            techIndex: "Skor 0-100 adopsi digital (IoT, E-commerce, otomatisasi pabrik).",
            trl: "Technology Readiness Level (1-9). 1=Riset Dasar, 9=Teruji dan komersial masif.",
            jobShift: "Proyeksi pertumbuhan/pergeseran penyerapan tenaga kerja dalam %.",
            valueAdd: "Indeks 1-10 sejauh mana bahan baku diolah sebelum dijual.",
            integration: "Indeks 1-10 integrasi hulu-hilir (rantai pasok terbentuk di dalam daerah).",
            importSub: "Persentase (%) potensi produk ini bisa menggantikan barang yang selama ini diimpor.",
            gvcPos: "Posisi di Global Value Chain (1-10). 1=Penyedia bahan mentah, 10=Pemilik Brand Global."
        };

        const SECTOR_CONFIG = [
            { key: 'localVal', label: 'Local Output (USD Million)', type: 'number' }, // Ubah Label
            { key: 'nationalVal', label: 'National Output (USD Million)', type: 'number' }, // Ubah Label
            { key: 'workers', label: 'Labor Force (Jiwa)', type: 'number' },
            { key: 'exportVal', label: 'Export Value (USD Million)', type: 'number' }, // Ubah Label
            { key: 'rnd', label: 'R&D Spend (% PDRB)', type: 'number' }, // Target: 0.1 - 3.0%
            { key: 'collab', label: 'Univ-Ind Collab (Unit)', type: 'number' }, // Jumlah kerjasama
            { key: 'patents', label: 'Patent/HKI (Count)', type: 'number' }, // Jumlah HKI
            { key: 'techIndex', label: 'Tech Adoption (0-100)', type: 'number' }, // Skor Adopsi Digital
            { key: 'trl', label: 'TRL (1-9)', type: 'number' }, // Technology Readiness Level
            { key: 'jobShift', label: 'Emp. Shift Proj. (% Growth)', type: 'number' }, // Employment shift
            { key: 'valueAdd', label: 'Value-Add Index (1-10)', type: 'number' },       // Value-added upgrading
            { key: 'integration', label: 'Upstream-Down Integration (1-10)', type: 'number' }, // Integration score
            { key: 'importSub', label: 'Import Sub. Potential (%)', type: 'number' },   // Import substitution
            { key: 'gvcPos', label: 'GVC Position (1=Raw, 10=Brand)', type: 'number' }  // Global Value Chain

        ];

        // --- COMPONENTS ---

        const Accordion = ({ title, isOpen, onClick, children, extraAction, icon = 'üìÅ' }) => (
            <div className="border-b border-slate-200">
                <div className={`flex justify-between items-center p-4 cursor-pointer transition-colors ${isOpen ? 'bg-slate-50 border-l-4 border-navy-700' : 'bg-white hover:bg-slate-50'}`} onClick={onClick}>
                    <h3 className="font-bold text-navy-800 uppercase text-xs tracking-wider flex items-center gap-2">
                        <span>{icon}</span> {title}
                    </h3>
                    <div className="flex items-center gap-3">
                        {extraAction && <div onClick={e => e.stopPropagation()}>{extraAction}</div>}
                        <span className={`text-slate-400 text-xs transition-transform transform ${isOpen ? 'rotate-180' : ''}`}>‚ñº</span>
                    </div>
                </div>
                {isOpen && <div className="p-4 bg-slate-50 border-t border-slate-100 animate-fadeIn">{children}</div>}
            </div>
        );

        const Input = ({ label, fieldKey, val, setVal, type="text", placeholder="" }) => (
            <div className="mb-3">
                <div className="flex items-center mb-1">
                    <label className="text-[10px] uppercase font-bold text-slate-500">{label}</label>
                    {HELP_REGISTRY[fieldKey] && (
                        <div className="tooltip-container">
                            <span className="tooltip-icon">?</span>
                            <span className="tooltip-text">{HELP_REGISTRY[fieldKey]}</span>
                        </div>
                    )}
                </div>
                {type === 'textarea' ? 
                    <textarea className="w-full border border-slate-300 rounded p-2 text-sm bg-white focus:border-blue-500 outline-none transition-shadow focus:shadow-sm" rows="3" value={val} onChange={e=>setVal(e.target.value)} placeholder={placeholder} /> :
                    <input className="w-full border border-slate-300 rounded p-2 text-sm bg-white focus:border-blue-500 outline-none transition-shadow focus:shadow-sm" type={type} value={val} onChange={e=>setVal(e.target.value)} placeholder={placeholder} />
                }
            </div>
        );

        // --- DATA TAMBAHAN: SDGs ---
        const SDG_OPTIONS = [
            { code: "SDG 1", label: "No Poverty", color: "bg-red-500" },
            { code: "SDG 8", label: "Decent Work & Economy", color: "bg-red-700" },
            { code: "SDG 9", label: "Industry & Innovation", color: "bg-orange-500" },
            { code: "SDG 11", label: "Sustainable Cities", color: "bg-yellow-600" },
            { code: "SDG 12", label: "Responsible Consumption", color: "bg-yellow-700" },
            { code: "SDG 17", label: "Partnership for Goals", color: "bg-blue-800" }
        ];

        // --- MAIN APP ---
        const App = () => {
            const [activeSection, setActiveSection] = useState("general"); 
            
            // Core Data State
            const [regionName, setRegionName] = useState("");
            const [governance, setGovernance] = useState({ 
                    vision: "", 
                    timeline: "", 
                    coordIndex: 0,   // Coordination capacity index
                    policyCoh: 0,    // Policy coherence score
                    pppReady: 0,     // Public-private partnership readiness
                    budgetAbs: 0     // Budget absorption capacity
            });
            const [finance, setFinance] = useState({
                publicInv: 0,       // Investasi Publik (USD M)
                privateInv: 0,      // Investasi Swasta (USD M)
                fundingNeeded: 0,   // Total Kebutuhan Dana (USD M)
                divIndex: 0,        // Indeks Diversifikasi (0-100)
                blendedReady: 0     // Kesiapan Blended Finance (0-100)
            });
            const [equity, setEquity] = useState({
                giniImpact: 0,      // Proyeksi perubahan Gini (misal: -0.01 berarti mengurangi ketimpangan)
                genderInc: 0,       // Indeks inklusi gender (0-100%)
                smePart: 0,         // Tingkat partisipasi UMKM (0-100%)
                ruralShare: 0,      // Porsi pelibatan masyarakat desa (0-100%)
                youthMult: 0        // Pengganda serapan tenaga kerja pemuda (misal: 1.5x)
            });
            // Environment & Resilience State
            const [environment, setEnvironment] = useState({
                climateVuln: 0, // Indeks Kerentanan Iklim (0-100)
                carbonInt: 0,   // Intensitas Karbon (Ton CO2 per $1M Output)
                waterRisk: 0,   // Risiko ketergantungan air (0-100)
                bioRisk: 0      // Risiko terhadap keanekaragaman hayati (0-100)
            });
            // Monitoring & KPI State
            const [kpis, setKpis] = useState([
            ]);
            // Sector State
            const [sectors, setSectors] = useState([
               ]);
            // STATE BARU: Identitas Pejabat & Logo
            const [signer, setSigner] = useState({ name: "", title: "" });
            const [logo, setLogo] = useState(null); // Untuk menyimpan URL gambar logo
            
            // Fungsi untuk handle upload logo
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const imageUrl = URL.createObjectURL(file);
                    setLogo(imageUrl);
                }
            };
            
            // Expanded Substance State
            const [swot, setSwot] = useState({ s: "", w: "", o: "", t: "" });
            const [stakeholders, setStakeholders] = useState([]);
            const [actionPlan, setActionPlan] = useState([]);
            
            // Legacy & UI State
            const [customModules, setCustomModules] = useState([]);
            const [customData, setCustomData] = useState({});
            const [apiKey, setApiKey] = useState("");
            const [aiAnalysis, setAiAnalysis] = useState("");
            const [aiLoading, setAiLoading] = useState(false);

            // --- STATE UNTUK UNIVERSAL CLOUD CONNECTOR ---
            const [showDbModal, setShowDbModal] = useState(false);
            const [isSending, setIsSending] = useState(false);
            const [dbConfig, setDbConfig] = useState({
                provider: 'google', // Pilihan: google, aws, firebase, custom
                endpoint: '',
                apiKey: '',
                collection: 's3_data' // Khusus Firebase/MongoDB
            });
            
            // Fungsi ini berguna untuk mengubah angka biasa (misal: 100) menjadi format uang ($100 M)
            const formatUSD = (val) => {
            if (!val) return "$0";
            return new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: 'USD',
              minimumFractionDigits: 0,
              maximumFractionDigits: 1
             }).format(val) + " M"; // Kita tambah 'M' untuk Million/Juta
        };
            // Fungsi Menghitung Skor Inovasi (Weighted Average)
            const calculateInnoScore = (s) => {
    // Bobot (Bisa disesuaikan seleramu):
    // TRL (30%), R&D (20%), Tech Index (30%), Kolaborasi (10%), Paten (10%)
    
            const trlScore = ((s.trl || 0) / 9) * 30; // TRL max 9
            const rndScore = Math.min(((s.rnd || 0) / 2) * 20, 20); // Asumsi R&D 2% sudah bagus
            const techScore = ((s.techIndex || 0) / 100) * 30;
            const collabScore = Math.min((s.collab || 0) * 2, 10); // Tiap collab nambah poin
            const patentScore = Math.min((s.patents || 0) * 2, 10); // Tiap paten nambah poin
            const total = Math.round(trlScore + rndScore + techScore + collabScore + patentScore);
    
    // Klasifikasi Label
            let label = "Lagging";
            let color = "bg-slate-100 text-slate-600";
    
            if (total > 75) { label = "Leader"; color = "bg-purple-100 text-purple-700 border-purple-200"; }
             else if (total > 50) { label = "Follower"; color = "bg-blue-100 text-blue-700 border-blue-200"; }
             else if (total > 25) { label = "Adopter"; color = "bg-yellow-100 text-yellow-700 border-yellow-200"; }
    
             return { score: total, label, color };
            };

                // --- FUNGSI BARU: UPGRADE FEASIBILITY INDEX ---
         const calculateFeasibility = (s) => {
             // 1. Innovation Score (Sudah ada, skala 0-100)
             const inno = calculateInnoScore(s).score;

             // 2. Institutional Capacity (Rata-rata 4 indikator Governance)
             const instCap = ((governance.coordIndex || 0) + (governance.policyCoh || 0) + (governance.pppReady || 0) + (governance.budgetAbs || 0)) / 4;

             // 3. Financial Readiness (Ambil dari kesiapan Blended Finance)
             const finReady = finance.blendedReady || 0;

             // 4. Market Opportunity (Asumsi dari posisi GVC dikali 10 biar jadi skala 100)
             const marketOpp = (s.gvcPos || 5) * 10;

             // 5. Risk Inverse (100 dikurangi rata-rata risiko iklim/air/bio)
             const avgRisk = ((environment.climateVuln || 0) + (environment.waterRisk || 0) + (environment.bioRisk || 0)) / 3;
             const riskInverse = Math.max(0, 100 - avgRisk);

             // RUMUS COMPOSITE SESUAI REQUEST-MU
             const totalScore = (0.3 * inno) + (0.2 * instCap) + (0.2 * finReady) + (0.2 * marketOpp) + (0.1 * riskInverse);
             const finalScore = Math.round(totalScore);

             // Klasifikasi Label & Warna UI
             let label = "Not Ready";
             let color = "bg-red-100 text-red-700 border-red-200";

             if (finalScore > 75) { 
                 label = "Highly Feasible"; 
                 color = "bg-emerald-100 text-emerald-800 border-emerald-200"; 
             } else if (finalScore > 50) { 
                 label = "Moderate Prep"; 
                 color = "bg-amber-100 text-amber-800 border-amber-200"; 
             }

             return { score: finalScore, label, color };
         };

            // Fungsi Analisis Jalur Transformasi (Upgrade Pathway)
        const analyzePathway = (s) => {
            // Kita ambil nilai default 0 jika user belum isi
            const va = s.valueAdd || 0;
            const gvc = s.gvcPos || 0;
            const imp = s.importSub || 0;
    
            let pathName = "Stagnant"; // Status default
            let pathDesc = "Perlu intervensi dasar";
            let badgeColor = "bg-gray-100 text-gray-600";

            // Logika Ekonomi Sederhana:
            if (gvc > 7 && va > 7) {
        pathName = "Global Frontrunner";
        pathDesc = "Memimpin pasar global (High GVC & Value Add)";
        badgeColor = "bg-emerald-100 text-emerald-800 border-emerald-200";
            } else if (imp > 60) {
        pathName = "Domestic Sovereign";
        pathDesc = "Substitusi Impor Kuat (Kemandirian Lokal)";
        badgeColor = "bg-blue-100 text-blue-800 border-blue-200";
            } else if (s.integration > 7) {
        pathName = "Industrial Deepening";
        pathDesc = "Hilirisasi & Integrasi Rantai Pasok";
        badgeColor = "bg-indigo-100 text-indigo-800 border-indigo-200";
            } else if (s.jobShift > 5) {
        pathName = "Job Creator";
        pathDesc = "Penyerapan Tenaga Kerja Masif";
        badgeColor = "bg-orange-100 text-orange-800 border-orange-200";
            }

            return { name: pathName, desc: pathDesc, color: badgeColor };
            };

            const [showKeyModal, setShowKeyModal] = useState(false);

            // Refs
            const reportRef = useRef(null);
            const lqRef = useRef(null);
            const radarRef = useRef(null);
            const chartInstances = useRef({});

            // --- DATA HANDLERS SAMPLE DUMMY ---
            const loadSampleData = () => {
                // 1. General
                setRegionName("Kabupaten Flores Timur");
                setGovernance({ 
                    vision: "Menjadi sentra agro-industri berkelanjutan berbasis kearifan lokal yang berdaya saing global.", 
                    timeline: "2024-2029", 
                    coordIndex: 65,  // Koordinasi antar dinas masih 65%
                    policyCoh: 70,   // Kebijakan cukup selaras 70%
                    pppReady: 45,    // Kesiapan investasi swasta masih rendah 45%
                    budgetAbs: 88    // Serapan anggaran bagus 88%
                });
                setEnvironment({
                 climateVuln: 75, // Tinggi: Pulau kecil rentan perubahan iklim & cuaca ekstrem
                 carbonInt: 120,  // Cukup rendah: Didominasi agro-industri, bukan alat berat
                 waterRisk: 80,   // Tinggi: NTT daerah kering, air bersih sangat vital
                 bioRisk: 30      // Rendah: Praktik tenun & kopi relatif ramah alam
                 });
                setFinance({
                    fundingNeeded: 150,  // Butuh $150 Juta
                    publicInv: 30,       // APBD/Pemerintah cuma sanggup $30 Juta
                    privateInv: 45,      // Komitmen Swasta/CSR $45 Juta
                    divIndex: 65,        // Indeks diversifikasi cukup baik (65/100)
                    blendedReady: 55     // Kesiapan Blended Finance level menengah (55/100)
                });
                setEquity({
                giniImpact: -0.015, // Strategi ini diproyeksikan menurunkan Gini 0.015 poin
                genderInc: 45,      // 45% pelibatan perempuan (pengrajin tenun dll)
                smePart: 80,        // 80% industri digerakkan UMKM
                ruralShare: 65,     // 65% dana mengalir langsung ke desa
                youthMult: 2.1      // 1 pekerjaan langsung ciptakan 2.1 pekerjaan untuk pemuda
            });
            // Dummy Data untuk Monitoring & KPI
                setKpis([
                 { id: 301, name: "Pembangunan Rumah Jemur Kopi", type: "Output", baselineYear: "2023", baselineVal: "2", targetYear: "2029", targetVal: "15", unit: "Unit" },
                 { id: 302, name: "Nilai Ekspor Kopi Premium", type: "Outcome", baselineYear: "2023", baselineVal: "15", targetYear: "2029", targetVal: "45", unit: "USD Juta" },
                 { id: 303, name: "Sertifikasi Indikator Geografis UMKM", type: "Output", baselineYear: "2023", baselineVal: "10", targetYear: "2029", targetVal: "150", unit: "UMKM" },
                 { id: 304, name: "Tingkat Pengangguran Terbuka (TPT)", type: "Impact", baselineYear: "2023", baselineVal: "6.5", targetYear: "2029", targetVal: "4.2", unit: "%" }
             ]);
                
                // 2. Sectors (SDA & Culture)
                setSectors([
                   { 
                        id: 1, 
                        name: "Kopi Flores (Specialty)", 
                        localVal: 30, nationalVal: 800, workers: 5000, exportVal: 15,// Data Inovasi
                        rnd: 1.2,        // 1.2% PDRB untuk riset kopi
                        collab: 3,       // Kerjasama dengan 3 Kampus
                        patents: 2,      // Ada 2 Indikator Geografis
                        techIndex: 75,   // Adopsi teknologi tinggi
                        trl: 8,          // TRL 8 (Sudah teruji lapangan)
                        jobShift: 2.5,     // Pertumbuhan tenaga kerja 2.5%
                        valueAdd: 8,       // Nilai tambah tinggi (sudah roasting/packaging)
                        integration: 7,    // Integrasi cukup baik
                        importSub: 10,     // Bukan substitusi impor (karena kita eksportir)
                        gvcPos: 8,         // Posisi GVC tinggi (Brand Global)
                        rationale: "Indikator Geografis (IG) kuat, pasar premium global.",
                        tech: "Smart Farming (IoT) & Traceability Blockchain" // <--- Contoh Tech
                    },
                    { 
                        id: 2, 
                        name: "Tenun Ikat", 
                        localVal: 8,        // $8 Juta
                        nationalVal: 1500, 
                        workers: 2500, 
                        exportVal: 3,       // $3 Juta
                        jobShift: 6.0,     // Padat karya (banyak serap nelayan)
                        valueAdd: 4,       // Masih jual ikan mentah (rendah)
                        integration: 9,    // Sangat terintegrasi hulu-hilir (pakan-tangkap-jual)
                        importSub: 80,     // Bisa ganti ikan impor (Pindang/Sarden kaleng)
                        gvcPos: 3,         // Masih main di bahan baku
                        rationale: "Warisan budaya tak benda, nilai tambah tinggi.",
                        tech: "Digital Archive Motif & E-Commerce Global" // <--- Contoh Tech
                    },
                    { 
                        id: 3, 
                        name: "Perikanan Tangkap", 
                        localVal: 800, nationalVal: 90000, workers: 8000, exportVal: 100, 
                        rationale: "Potensi laut luas, namun hilirisasi masih minim.",
                        tech: "Fish Finder (Sonar) & Cold Chain Management System" // <--- Contoh Tech
                    }
                ]);

                // 3. SWOT Analysis (Strategic)
                setSwot({
                    s: "1. Kualitas tanah vulkanik untuk pertanian.\n2. Tradisi tenun yang masih hidup di masyarakat.\n3. Posisi strategis jalur laut.",
                    w: "1. Infrastruktur pengolahan pasca panen minim.\n2. Akses permodalan perbankan rendah.\n3. Branding digital belum optimal.",
                    o: "1. Tren global 'Slow Fashion' & 'Organic Food'.\n2. Dukungan pemerintah pusat untuk Destinasi Super Prioritas (Labuan Bajo impact).",
                    t: "1. Perubahan iklim mengganggu panen.\n2. Persaingan dengan produk tekstil pabrikan murah."
                });

                // 4. Quadruple Helix (Collaboration)
                setStakeholders([
                    { id: 101, name: "Bappelitbangda", role: "Government", task: "Regulasi & Fasilitasi" },
                    { id: 102, name: "Univ. Nusa Cendana", role: "Academic", task: "Riset Varietas Kopi" },
                    { id: 103, name: "Koperasi Tani Mandiri", role: "Business", task: "Agregasi Produk" },
                    { id: 104, name: "Komunitas Adat", role: "Community", task: "Pelestarian Motif Tenun" }
                ]);

                // 5. Action Plan (Roadmap)
                setActionPlan([
                    { 
                        id: 201, 
                        activity: "Pembangunan Rumah Jemur Kopi", 
                        output: "5 Unit Green House", 
                        budget: "500 Juta", 
                        year: "2024",
                        sdg: "SDG 9" // <--- Industry & Innovation (Warna Oranye)
                    },
                    { 
                        id: 202, 
                        activity: "Festival Tenun Ikat Internasional", 
                        output: "1000 Pengunjung/Buyer", 
                        budget: "1 Milyar", 
                        year: "2025",
                        sdg: "SDG 11" // <--- Sustainable Cities/Communities (Warna Kuning)
                    },
                    { 
                        id: 203, 
                        activity: "Digitalisasi UMKM (Onboarding)", 
                        output: "50 UMKM Go Digital", 
                        budget: "200 Juta", 
                        year: "2024",
                        sdg: "SDG 8" // <--- Decent Work (Warna Merah)
                    }
                ]);

                alert("Sample Data Lengkap (SDG & Tech Ready) Telah Dimuat!");
            };

            const saveToJSON = () => {
                // Terdapat penambahan: signer dan dbConfig
                const data = { regionName, governance, finance, equity, environment, sectors, swot, stakeholders, actionPlan, kpis, customModules, customData, signer, dbConfig };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `S3_Strategy_${regionName.replace(/\s+/g,'_')}.json`;
                link.click();
            };

            const loadFromJSON = (e) => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        setRegionName(data.regionName || "");
                        setGovernance(data.governance || { vision: "", timeline: "", coordIndex:0, policyCoh:0, pppReady:0, budgetAbs:0 });
                        setFinance(data.finance || { publicInv: 0, privateInv: 0, fundingNeeded: 0, divIndex: 0, blendedReady: 0 });
                        // INI YANG KETINGGALAN KEMARIN (EQUITY)
                        setEquity(data.equity || { giniImpact: 0, genderInc: 0, smePart: 0, ruralShare: 0, youthMult: 0 }); 
                        setEnvironment(data.environment || { climateVuln: 0, carbonInt: 0, waterRisk: 0, bioRisk: 0 });
                        setSectors(data.sectors || []);
                        setSwot(data.swot || { s: "", w: "", o: "", t: "" });
                        setStakeholders(data.stakeholders || []);
                        setActionPlan(data.actionPlan || []);
                        setKpis(data.kpis || []);
                        setCustomModules(data.customModules || []);
                        setCustomData(data.customData || {});
                        // TAMBAHAN LOAD UNTUK PEJABAT & DB
                        setSigner(data.signer || { name: "", title: "" });
                        setDbConfig(data.dbConfig || { provider: 'google', endpoint: '', apiKey: '', collection: 's3_data' });
                        
                        alert("Data Loaded Successfully!");
                    } catch (err) { alert("Invalid JSON File"); }
                };
                if(e.target.files[0]) reader.readAsText(e.target.files[0]);
                e.target.value = null;
            };

            // --- FUNGSI MODULAR FETCH ("BUNGLON") ---
const sendToServer = async () => {
    if (!dbConfig.endpoint) {
        alert("‚ö†Ô∏è URL Endpoint tidak boleh kosong!");
        return;
    }

    setIsSending(true);
    // Payload murni dari state
    const payload = { 
        regionName, governance, finance, equity, environment, 
        sectors, swot, stakeholders, actionPlan, kpis 
    };

    try {
        let fetchUrl = dbConfig.endpoint;
        let headers = { 'Content-Type': 'application/json' };

        // Logika adaptasi untuk Google Apps Script, Firebase, dll
        switch (dbConfig.provider) {
            case 'google':
                headers = { 'Content-Type': 'text/plain' }; 
                break;
            case 'aws':
                if (dbConfig.apiKey) headers['x-api-key'] = dbConfig.apiKey;
                break;
            case 'firebase':
                fetchUrl = fetchUrl.endsWith('/') ? fetchUrl : fetchUrl + '/';
                fetchUrl = `${fetchUrl}${dbConfig.collection}.json`;
                if (dbConfig.apiKey) fetchUrl += `?auth=${dbConfig.apiKey}`;
                break;
            case 'custom':
                if (dbConfig.apiKey) headers['Authorization'] = `Bearer ${dbConfig.apiKey}`;
                break;
        }

        const response = await fetch(fetchUrl, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            alert(`‚úÖ Data berhasil dikirim ke ${dbConfig.provider.toUpperCase()}!`);
            setShowDbModal(false);
        } else {
            throw new Error(`Server menolak respons (Status: ${response.status}).`);
        }
    } catch (error) {
        alert("‚ùå Gagal mengirim data.\nPastikan URL dan API Key benar, serta server menerima POST.\n\nDetail: " + error.message);
    } finally {
        setIsSending(false);
    }
};
            // --- CHART LOGIC ---
            const processedData = useMemo(() => {
                const totLoc = sectors.reduce((a,b)=>a+(b.localVal||0),0) || 1;
                const totNat = sectors.reduce((a,b)=>a+(b.nationalVal||0),0) || 1;
                const data = sectors.map(s => ({
                    ...s,
                    lq: parseFloat(((s.localVal/totLoc)/(s.nationalVal/totNat) || 0).toFixed(2))
                })).sort((a,b) => b.lq - a.lq);
                return { data };
            }, [sectors]);

            useEffect(() => {
                if(processedData.data.length === 0) return;
                // Update Charts logic similar to before, kept concise
                if(lqRef.current) {
                    if(chartInstances.current.lq) chartInstances.current.lq.destroy();
                    chartInstances.current.lq = new Chart(lqRef.current, {
                        type: 'bar',
                        data: {
                            labels: processedData.data.map(s => s.name),
                            datasets: [{ label: 'LQ Score', data: processedData.data.map(s => s.lq), backgroundColor: '#1e3a5f', borderRadius: 4 }]
                        },
                        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                    });
                }
                // --- UPDATE: RADAR CHART S3 IDEAL ---
                if(radarRef.current) {
                    if(chartInstances.current.radar) chartInstances.current.radar.destroy();
                    
                    // Kita tarik data Governance (Inst. Support) dan Environment (Risk Inverse)
                    // Jika data belum diisi, kita beri nilai default tengah (5 dari skala 10)
                    const govScore = governance ? ((governance.coordIndex || 0) + (governance.policyCoh || 0)) / 20 : 5;
                    
                    // Risk Inverse = Semakin kecil risiko lingkungan, skor radarnya makin besar/luas (mendekati 10)
                    const riskInverse = environment ? 10 - (((environment.climateVuln || 0) + (environment.waterRisk || 0)) / 20) : 5;

                    chartInstances.current.radar = new Chart(radarRef.current, {
                        type: 'radar',
                        data: {
                            // Ini adalah 6 sumbu ideal arahan dosen kebijakan publik!
                            labels: ['Economic Strength', 'Innovation Cap.', 'Market Opp.', 'Inst. Support', 'Risk Level (Inv)', 'Upgrade Feas.'],
                            datasets: processedData.data.slice(0,3).map((s,i) => {
                                
                                // Kalkulasi cerdas dari data input sektor (Skala 0 - 10)
                                const econStr = Math.min(10, (s.lq || 1) * 2 + (s.exportVal > 20 ? 3 : 1));
                                const innoCap = calculateInnoScore(s).score / 10; // Konversi dari 100 ke 10
                                const marketOpp = Math.min(10, (s.gvcPos || 5) + (s.exportVal > 10 ? 2 : 0));
                                const upgradeFeas = Math.min(10, ((s.trl || 5) + (s.integration || 5)) / 2 * 1.2);

                                // Palet warna elegan untuk 3 sektor teratas
                                const colors = [
                                    { bg: 'rgba(30,58,95,0.2)', border: '#1e3a5f' },   // Navy
                                    { bg: 'rgba(224,122,95,0.2)', border: '#e07a5f' }, // Terracotta
                                    { bg: 'rgba(30,142,62,0.2)', border: '#1e8e3e' }    // Emerald (Hijau)
                                ];

                                return {
                                    label: s.name,
                                    data: [econStr, innoCap, marketOpp, govScore, riskInverse, upgradeFeas],
                                    backgroundColor: colors[i % 3].bg,
                                    borderColor: colors[i % 3].border,
                                    borderWidth: 2,
                                    pointBackgroundColor: colors[i % 3].border
                                };
                            })
                        },
                        options: { 
                            responsive: true, 
                            maintainAspectRatio: false, 
                            scales: { 
                                r: { min: 0, max: 10, ticks: { stepSize: 2 } } 
                            },
                            plugins: {
                                legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 9 } } }
                            }
                        }
                    });
                }
            }, [processedData, governance, environment]);

            const handleAI = async () => {
                if(!apiKey) return setShowKeyModal(true);
                setAiLoading(true);
                // Enhanced Prompt with new data
                const prompt = `Role: Senior Economic Strategist. 
                Context: S3 Strategy for ${regionName}.
                Vision: ${governance.vision}.
                SWOT Summary: S:${swot.s}, W:${swot.w}, O:${swot.o}, T:${swot.t}.
                Key Sectors: ${JSON.stringify(sectors.map(s=>s.name))}.
                Stakeholders: ${stakeholders.length} entities.
                Action Plan: ${actionPlan.length} items.
                
                Task: Create a cohesive Executive Summary (max 300 words). Integrate the Vision with the Sectors and SWOT. Use professional, persuasive language. Output in HTML format (<p>, <strong>, <ul>).`;
                
                try {
                    const res = await AI_BRIDGE.generate(prompt, apiKey);
                    setAiAnalysis(res);
                } catch (e) { alert("AI Error: " + e.message); } 
                finally { setAiLoading(false); }
            }
            // --- FUNGSI BARU: EXPORT TO WORD ---
            const exportToWord = () => {
                if (!reportRef.current) return;

                // 1. Kita clone (duplikat) dulu elemen report-nya agar tampilan asli tidak berubah
                const originalElement = reportRef.current;
                const clone = originalElement.cloneNode(true);

                // 2. Trik Sulap: Ubah semua Chart (Canvas) menjadi Gambar (Image)
                // Word tidak bisa baca <canvas>, jadi harus jadi <img>
                const originalCanvases = originalElement.querySelectorAll('canvas');
                const clonedCanvases = clone.querySelectorAll('canvas');

                clonedCanvases.forEach((clonedCanvas, index) => {
                    const originalCanvas = originalCanvases[index];
                    // Buat elemen gambar baru
                    const img = document.createElement('img');
                    // Ambil data gambar dari canvas asli
                    img.src = originalCanvas.toDataURL('image/png'); 
                    // Set ukuran agar rapi
                    img.style.width = '100%';
                    img.style.maxWidth = '100%';
                    
                    // Ganti canvas di clone dengan gambar
                    clonedCanvas.parentNode.replaceChild(img, clonedCanvas);
                });

                // 3. Persiapkan HTML untuk Word
                // Kita tambahkan sedikit style inline agar tabel ada garisnya di Word
                const htmlContent = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                    <head>
                        <meta charset='utf-8'>
                        <title>Export Document</title>
                        <style>
                            /* Sedikit style dasar agar tabel rapi di Word */
                            body { font-family: 'Arial', sans-serif; }
                            table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
                            th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                            h1, h2, h3 { color: #1e3a5f; }
                            .no-print { display: none; } /* Sembunyikan tombol close di dalam konten */
                        </style>
                    </head>
                    <body>
                        ${clone.innerHTML}
                    </body>
                    </html>
                `;

                // 4. Bungkus jadi Blob (File Object)
                const blob = new Blob(['\ufeff', htmlContent], {
                    type: 'application/msword'
                });

                // 5. Download File
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `S3_Strategy_${regionName || 'Document'}.doc`; // Ekstensi .doc agar mudah dibuka
                document.body.appendChild(link);
                link.click();
                
                // Bersihkan memori
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="flex h-screen bg-slate-100 overflow-hidden text-slate-800 font-sans">
                    {/* MODALS */}
                    {showKeyModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
                            <div className="bg-white p-6 rounded-xl shadow-2xl w-96 animate-fadeIn border border-slate-200">
                                <h3 className="font-bold text-lg mb-2 flex items-center gap-2">üîë AI Configuration</h3>
                                <p className="text-xs text-slate-500 mb-4">Paste your Gemini API Key to unlock AI Analysis features.</p>
                                <input type="password" placeholder="sk-..." className="w-full border p-2 rounded mb-4 text-sm font-mono bg-slate-50" value={apiKey} onChange={e=>setApiKey(e.target.value)} />
                                <div className="flex justify-end gap-2"><button onClick={()=>setShowKeyModal(false)} className="px-4 py-2 text-sm text-slate-500 hover:text-slate-800">Cancel</button><button onClick={()=>setShowKeyModal(false)} className="px-4 py-2 text-sm bg-navy-900 text-white rounded font-bold hover:bg-navy-700">Connect</button></div>
                            </div>
                        </div>
                    )}
                    {/* --- UI MODAL UNIVERSAL CLOUD CONNECTOR --- */}
{showDbModal && (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div className="bg-white p-6 rounded-xl shadow-2xl w-[450px] animate-fadeIn border border-slate-200">
            <div className="flex justify-between items-center mb-4">
                <h3 className="font-bold text-lg flex items-center gap-2">üöÄ Universal API Connector</h3>
                <button onClick={()=>setShowDbModal(false)} className="text-slate-400 hover:text-red-500 font-bold">‚úï</button>
            </div>

            <div className="bg-indigo-50 border border-indigo-200 text-indigo-800 text-[10px] p-3 rounded-lg mb-4 flex items-start gap-2">
                <span className="text-lg leading-none">‚ÑπÔ∏è</span>
                <div>
                    <strong>Standardized JSON Payload:</strong><br/>
                    Data yang dikirim menggunakan struktur murni. Mendukung integrasi dengan <i>Data Warehouse</i> apapun.
                </div>
            </div>

            <label className="text-[9px] font-bold text-slate-500 uppercase block mb-1">Target Platform</label>
            <select 
                className="w-full border p-2 rounded mb-3 text-sm bg-slate-50 focus:border-blue-500 outline-none font-bold text-navy-800"
                value={dbConfig.provider} 
                onChange={e=>setDbConfig({...dbConfig, provider: e.target.value})}
            >
                <option value="google">Google Workspace (Apps Script / Sheets)</option>
                <option value="aws">AWS (API Gateway)</option>
                <option value="firebase">Firebase (Realtime Database)</option>
                <option value="custom">Custom Webhook / REST API</option>
            </select>

            <label className="text-[9px] font-bold text-slate-500 uppercase block mb-1">
                {dbConfig.provider === 'firebase' ? 'Database URL' : 'API Endpoint URL'}
            </label>
            <input 
                type="url" 
                placeholder="https://..." 
                className="w-full border p-2 rounded mb-3 text-xs bg-white focus:border-blue-500 outline-none" 
                value={dbConfig.endpoint} 
                onChange={e=>setDbConfig({...dbConfig, endpoint: e.target.value})} 
            />

            {dbConfig.provider === 'firebase' && (
                <>
                    <label className="text-[9px] font-bold text-slate-500 uppercase block mb-1">Collection / Node Name</label>
                    <input type="text" className="w-full border p-2 rounded mb-3 text-xs bg-white focus:border-blue-500 outline-none" 
                        value={dbConfig.collection} onChange={e=>setDbConfig({...dbConfig, collection: e.target.value})} />
                </>
            )}

            {dbConfig.provider !== 'google' && (
                <>
                    <label className="text-[9px] font-bold text-slate-500 uppercase block mb-1">
                        {dbConfig.provider === 'aws' ? 'x-api-key (Optional)' : 'Auth Token / Secret Key (Optional)'}
                    </label>
                    <input 
                        type="password" 
                        placeholder="Enter token..." 
                        className="w-full border p-2 rounded mb-4 text-xs bg-white focus:border-blue-500 outline-none font-mono" 
                        value={dbConfig.apiKey} 
                        onChange={e=>setDbConfig({...dbConfig, apiKey: e.target.value})} 
                    />
                </>
            )}

            <div className="flex justify-end gap-2 mt-4 pt-4 border-t border-slate-100">
                <button 
                    onClick={sendToServer} 
                    disabled={isSending}
                    className={`w-full py-2.5 text-sm text-white rounded font-bold transition-colors shadow-sm flex items-center justify-center gap-2 ${isSending ? 'bg-slate-400' : 'bg-navy-900 hover:bg-navy-800'}`}>
                    {isSending ? 'Transmitting Data...' : 'Transmit JSON Payload'}
                </button>
                        </div>
                     </div>
                </div>
                )}

                    {/* LEFT SIDEBAR (INPUTS) */}
                    {/* UBAH BARIS INI (Tambahkan print:hidden) */}
                    <div className="w-4/12 bg-white border-r flex flex-col z-10 shadow-xl print:hidden">
                        <div className="p-5 bg-navy-900 text-white flex justify-between items-center shrink-0">
                            <div><h1 className="font-bold tracking-widest text-lg">S3 BUILDER</h1><div className="text-[10px] opacity-70">Professional Edition</div></div>
                            <div className="flex gap-1">
                                <button onClick={()=>setShowDbModal(true)} title="Cloud Connector" className="p-2 text-white hover:bg-white/10 rounded">‚òÅÔ∏è</button>
                                <button onClick={()=>setShowKeyModal(true)} title="AI Settings" className={`p-2 rounded transition-colors ${apiKey ? 'text-green-400' : 'text-slate-400 hover:text-white'}`}>‚öôÔ∏è</button>
                                <button onClick={saveToJSON} title="Save" className="p-2 text-white hover:bg-white/10 rounded">üíæ</button>
                                <label title="Load" className="p-2 text-white hover:bg-white/10 rounded cursor-pointer">üìÇ<input type="file" onChange={loadFromJSON} className="hidden" accept=".json" /></label>
                            </div>
                        </div>
                        
                        <div className="bg-navy-800 px-5 py-2 flex justify-between items-center border-t border-navy-700">
                            <span className="text-[10px] text-slate-300">Quick Actions:</span>
                            <button onClick={loadSampleData} className="text-[10px] bg-terracotta-500 hover:bg-terracotta-600 text-white px-3 py-1 rounded font-bold shadow-sm transition-colors">Load Sample Data</button>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar">
                            {/* 1. GENERAL SIDEBAR INPUT */}
                            <Accordion title="General Identity" icon="üèõÔ∏è" isOpen={activeSection === 'general'} onClick={() => setActiveSection(activeSection === 'general' ? '' : 'general')}>
                                <Input label="Region Name" fieldKey="regionName" val={regionName} setVal={setRegionName} placeholder="e.g. Kabupaten..." />
                                <Input label="Vision Statement" fieldKey="vision" type="textarea" val={governance.vision} setVal={v => setGovernance({...governance, vision: v})} placeholder="What is the big goal?" />
                                <Input label="Strategic Timeline" fieldKey="timeline" val={governance.timeline} setVal={v => setGovernance({...governance, timeline: v})} placeholder="e.g. 2024-2029" />
                                    <div className="mt-4 pt-4 border-t border-slate-200">
                                    <label className="text-[9px] uppercase font-bold text-navy-800 mb-2 block bg-slate-200 p-1 rounded inline-block px-2">
                                        üèõÔ∏è Institutional Capacity (0-100%)</label><div className="grid grid-cols-2 gap-2">
                                <Input label="Coordination Index" fieldKey="coordIndex" val={governance.coordIndex} setVal={v => setGovernance({...governance, coordIndex: v})} type="number" />
                                <Input label="Policy Coherence" fieldKey="policyCoh" val={governance.policyCoh} setVal={v => setGovernance({...governance, policyCoh: v})} type="number" />
                                <Input label="PPP Readiness" fieldKey="pppReady" val={governance.pppReady} setVal={v => setGovernance({...governance, pppReady: v})} type="number" />
                                <Input label="Budget Absorption" fieldKey="budgetAbs" val={governance.budgetAbs} setVal={v => setGovernance({...governance, budgetAbs: v})} type="number" />     </div></div>

                                    <div className="mt-4 pt-4 border-t border-slate-200">
                                    <label className="text-[9px] uppercase font-bold text-slate-400 mb-1 block">Logo Daerah/ Govt. Logo (PNG/JPG)</label>
                                    <input type="file" accept="image/*" onChange={handleLogoUpload} className="w-full text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mb-3"/>
                                    
                                    <div className="grid grid-cols-2 gap-2">
                                        <Input label="Nama Pejabat (Ttd)" val={signer.name} setVal={v => setSigner({...signer, name: v})} placeholder="Bpk. Nama Pejabat" />
                                        <Input label="Jabatan" val={signer.title} setVal={v => setSigner({...signer, title: v})} placeholder="Bupati Flores Timur" />
                                    </div>
                                </div>

                               </Accordion>

                            {/* 2. SECTORS */}
                            <Accordion title="Priority Sectors" icon="üìä" isOpen={activeSection === 'sectors'} onClick={() => setActiveSection(activeSection === 'sectors' ? '' : 'sectors')}
                                extraAction={<button onClick={(e) => { e.stopPropagation(); setSectors([...sectors, {id: Date.now(), name: "New Sector", localVal:0}]); setActiveSection('sectors'); }} className="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded font-bold border border-green-200 hover:bg-green-200">+ Add</button>}>
                                {sectors.length === 0 && <p className="text-xs text-slate-400 italic text-center py-4">No sectors defined. Add one to start analysis.</p>}
                                {sectors.map((s, idx) => (
                                    <div key={s.id} className="mb-4 p-3 border border-slate-200 rounded bg-slate-50 relative group">
                                        <button onClick={()=>setSectors(sectors.filter(x=>x.id!==s.id))} className="absolute top-2 right-2 text-slate-300 hover:text-red-500 font-bold transition-colors">√ó</button>
                                        <div className="font-bold text-[9px] text-navy-700 mb-2 uppercase tracking-widest bg-slate-200 inline-block px-1 rounded">Sector {idx+1}</div>
                                        <Input label="Sector Name" val={s.name} setVal={v => {const n=[...sectors]; n[idx].name=v; setSectors(n)}} />
                                        <div className="grid grid-cols-2 gap-2">
                                            {SECTOR_CONFIG.map(cfg => (
                                                <div key={cfg.key}>
                                                    <label className="text-[9px] uppercase font-bold text-slate-400">{cfg.label}</label>
                                                    <div className="flex items-center">
                                                        <input type="number" className="w-full border border-slate-300 rounded p-1 text-sm bg-white focus:border-blue-500 outline-none" value={s[cfg.key]||0} onChange={e=>{const n=[...sectors]; n[idx][cfg.key]=parseFloat(e.target.value); setSectors(n)}} />
                                                        {HELP_REGISTRY[cfg.key] && <div className="tooltip-container"><span className="tooltip-icon w-3 h-3 text-[8px]">?</span><span className="tooltip-text">{HELP_REGISTRY[cfg.key]}</span></div>}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        {/* --- UPDATE: RATIONALE & TECH FOCUS --- */}
                                            <div className="mt-2 grid grid-cols-1 md:grid-cols-2 gap-2">
                                                <div>
                                                    <label className="text-[9px] uppercase font-bold text-slate-400">Strategic Rationale</label>
                                                    <textarea className="w-full border border-slate-300 rounded p-1 text-sm bg-white focus:border-blue-500 outline-none" rows="3" value={s.rationale||""} onChange={e=>{const n=[...sectors]; n[idx].rationale=e.target.value; setSectors(n)}} placeholder="Kenapa sektor ini dipilih?"></textarea>
                                                </div>
                                                <div>
                                                    <label className="text-[9px] uppercase font-bold text-blue-500">Technology & Innovation Focus (IT/R&D)</label>
                                                    <textarea className="w-full border border-blue-200 bg-blue-50 rounded p-1 text-sm focus:border-blue-500 outline-none" rows="3" value={s.tech||""} onChange={e=>{const n=[...sectors]; n[idx].tech=e.target.value; setSectors(n)}} placeholder="Contoh: IoT untuk monitoring panen, E-Commerce, Blockchain traceability..."></textarea>
                                                </div>
                                            </div>
                                    </div>
                                ))}
                            </Accordion>

                            {/* 3. SWOT ANALYSIS (NEW) */}
                            <Accordion title="SWOT Analysis" icon="üõ°Ô∏è" isOpen={activeSection === 'swot'} onClick={() => setActiveSection(activeSection === 'swot' ? '' : 'swot')}>
                                <Input label="Strengths (Internal)" fieldKey="strength" type="textarea" val={swot.s} setVal={v => setSwot({...swot, s: v})} placeholder="List strengths..." />
                                <Input label="Weaknesses (Internal)" fieldKey="weakness" type="textarea" val={swot.w} setVal={v => setSwot({...swot, w: v})} placeholder="List weaknesses..." />
                                <div className="my-2 border-t border-slate-200"></div>
                                <Input label="Opportunities (External)" fieldKey="opportunity" type="textarea" val={swot.o} setVal={v => setSwot({...swot, o: v})} placeholder="List opportunities..." />
                                <Input label="Threats (External)" fieldKey="threat" type="textarea" val={swot.t} setVal={v => setSwot({...swot, t: v})} placeholder="List threats..." />
                            </Accordion>

                            {/* 4. QUADRUPLE HELIX (NEW) */}
                            <Accordion title="Stakeholders (Helix)" icon="ü§ù" isOpen={activeSection === 'helix'} onClick={() => setActiveSection(activeSection === 'helix' ? '' : 'helix')}
                                extraAction={<button onClick={(e) => { e.stopPropagation(); setStakeholders([...stakeholders, {id: Date.now(), name: "", role: "Government"}]); setActiveSection('helix'); }} className="text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold border border-blue-200 hover:bg-blue-200">+ Add</button>}>
                                {stakeholders.map((st, idx) => (
                                    <div key={st.id} className="mb-2 p-2 border border-slate-200 rounded flex gap-2 items-start bg-slate-50">
                                        <div className="flex-1">
                                            <input className="w-full border-b bg-transparent text-sm font-bold mb-1 focus:outline-none focus:border-blue-500" placeholder="Organization Name" value={st.name} onChange={e=>{const n=[...stakeholders]; n[idx].name=e.target.value; setStakeholders(n)}} />
                                            <div className="flex gap-2">
                                                <select className="text-xs border rounded p-1 w-1/2" value={st.role} onChange={e=>{const n=[...stakeholders]; n[idx].role=e.target.value; setStakeholders(n)}}>
                                                    <option value="Government">Government</option>
                                                    <option value="Academic">Academic</option>
                                                    <option value="Business">Business</option>
                                                    <option value="Community">Community</option>
                                                </select>
                                                <input className="text-xs border rounded p-1 w-1/2" placeholder="Key Task..." value={st.task||""} onChange={e=>{const n=[...stakeholders]; n[idx].task=e.target.value; setStakeholders(n)}} />
                                            </div>
                                        </div>
                                        <button onClick={()=>setStakeholders(stakeholders.filter(x=>x.id!==st.id))} className="text-slate-400 hover:text-red-500 font-bold px-1">√ó</button>
                                    </div>
                                ))}
                            </Accordion>

                            {/* 5. ACTION PLAN */}
                            <Accordion title="Action Plan" icon="üöÄ" isOpen={activeSection === 'action'} onClick={() => setActiveSection(activeSection === 'action' ? '' : 'action')}
                                extraAction={<button onClick={(e) => { e.stopPropagation(); setActionPlan([...actionPlan, {id: Date.now(), activity: "", year: "2024"}]); setActiveSection('action'); }} className="text-[10px] bg-purple-100 text-purple-700 px-2 py-1 rounded font-bold border border-purple-200 hover:bg-purple-200">+ Add</button>}>
                                {actionPlan.map((act, idx) => (
                                    <div key={act.id} className="mb-3 p-3 border border-slate-200 rounded bg-slate-50 relative">
                                        <button onClick={()=>setActionPlan(actionPlan.filter(x=>x.id!==act.id))} className="absolute top-1 right-2 text-slate-300 hover:text-red-500 font-bold">√ó</button>
                                        <Input label="Activity Name" fieldKey="actionActivity" val={act.activity} setVal={v=>{const n=[...actionPlan]; n[idx].activity=v; setActionPlan(n)}} />
                                        <div className="flex gap-2 mb-2">
                                                        <div className="w-1/4">
                                                            <label className="text-[9px] font-bold text-slate-400 uppercase">Year</label>
                                                            <input className="w-full border p-1 rounded text-xs" value={act.year||""} onChange={e=>{const n=[...actionPlan]; n[idx].year=e.target.value; setActionPlan(n)}} />
                                                        </div>
                                                        <div className="flex-1">
                                                            <label className="text-[9px] font-bold text-slate-400 uppercase">SDG Alignment</label>
                                                            <select className="w-full border p-1 rounded text-xs bg-white" value={act.sdg||""} onChange={e=>{const n=[...actionPlan]; n[idx].sdg=e.target.value; setActionPlan(n)}}>
                                                                <option value="">- Select Goal -</option>
                                                                {SDG_OPTIONS.map(opt => (
                                                                    <option key={opt.code} value={opt.code}>{opt.code} - {opt.label}</option>
                                                                ))}
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label className="text-[9px] font-bold text-slate-400 uppercase">Target/Output</label>
                                                        <input className="w-full border p-1 rounded text-xs" value={act.output||""} onChange={e=>{const n=[...actionPlan]; n[idx].output=e.target.value; setActionPlan(n)}} />
                                                    </div>
                                    </div>
                                ))}
                            </Accordion>

                            {/* 6. FINANCIAL LEVERAGE (NEW) */}
                            <Accordion title="Financial Leverage" icon="üí∞" isOpen={activeSection === 'finance'} onClick={() => setActiveSection(activeSection === 'finance' ? '' : 'finance')}>
                                <div className="p-2 bg-blue-50 rounded mb-4 text-[10px] text-blue-800 border border-blue-200">
                                    <strong>Tip:</strong> Isi dalam juta USD (USD Million). Rasio dan Gap Investasi akan dihitung otomatis.
                                </div>
                                <Input label="Total Funding Needed (USD M)" fieldKey="fundingNeeded" val={finance.fundingNeeded} setVal={v => setFinance({...finance, fundingNeeded: parseFloat(v) || 0})} type="number" />
                                <div className="grid grid-cols-2 gap-2">
                                    <Input label="Public Invest. (USD M)" fieldKey="publicInv" val={finance.publicInv} setVal={v => setFinance({...finance, publicInv: parseFloat(v) || 0})} type="number" />
                                    <Input label="Private Invest. (USD M)" fieldKey="privateInv" val={finance.privateInv} setVal={v => setFinance({...finance, privateInv: parseFloat(v) || 0})} type="number" />
                                </div>
                                <div className="border-t border-slate-200 my-2 pt-2 grid grid-cols-2 gap-2">
                                    <Input label="Diversification (0-100)" fieldKey="divIndex" val={finance.divIndex} setVal={v => setFinance({...finance, divIndex: parseFloat(v) || 0})} type="number" />
                                    <Input label="Blended Ready (0-100)" fieldKey="blendedReady" val={finance.blendedReady} setVal={v => setFinance({...finance, blendedReady: parseFloat(v) || 0})} type="number" />
                                </div>
                            </Accordion>
                            {/* 7. SOCIAL & EQUITY LENS (NEW) */}
                            <Accordion title="Social & Equity Lens" icon="‚öñÔ∏è" isOpen={activeSection === 'equity'} onClick={() => setActiveSection(activeSection === 'equity' ? '' : 'equity')}>
                                <div className="grid grid-cols-2 gap-2">
                                    <Input label="Gini Impact (+/-)" fieldKey="giniImpact" val={equity.giniImpact} setVal={v => setEquity({...equity, giniImpact: parseFloat(v) || 0})} type="number" />
                                    <Input label="Youth Job Mult. (x)" fieldKey="youthMult" val={equity.youthMult} setVal={v => setEquity({...equity, youthMult: parseFloat(v) || 0})} type="number" />
                                    <Input label="SME Part. (%)" fieldKey="smePart" val={equity.smePart} setVal={v => setEquity({...equity, smePart: parseFloat(v) || 0})} type="number" />
                                    <Input label="Rural Share (%)" fieldKey="ruralShare" val={equity.ruralShare} setVal={v => setEquity({...equity, ruralShare: parseFloat(v) || 0})} type="number" />
                                </div>
                                <div className="border-t border-slate-200 mt-2 pt-2">
                                    <Input label="Gender Inclusion Index (0-100)" fieldKey="genderInc" val={equity.genderInc} setVal={v => setEquity({...equity, genderInc: parseFloat(v) || 0})} type="number" />
                                </div>
                            </Accordion>
                            {/* 8. ENVIRONMENT & RESILIENCE (NEW) */}
                            <Accordion title="Environment & Resilience" icon="üå±" isOpen={activeSection === 'environment'} onClick={() => setActiveSection(activeSection === 'environment' ? '' : 'environment')}>
                                <div className="p-2 bg-emerald-50 rounded mb-4 text-[10px] text-emerald-800 border border-emerald-200">
                                    <strong>Tip ESG:</strong> Indikator ini wajib untuk mengakses pendanaan *Green Finance* atau *Climate Fund* global.
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <Input label="Climate Vuln. (0-100)" fieldKey="climateVuln" val={environment.climateVuln} setVal={v => setEnvironment({...environment, climateVuln: parseFloat(v) || 0})} type="number" />
                                    <Input label="Carbon Int. (Ton/$1M)" fieldKey="carbonInt" val={environment.carbonInt} setVal={v => setEnvironment({...environment, carbonInt: parseFloat(v) || 0})} type="number" />
                                    <Input label="Water Risk (0-100)" fieldKey="waterRisk" val={environment.waterRisk} setVal={v => setEnvironment({...environment, waterRisk: parseFloat(v) || 0})} type="number" />
                                    <Input label="Bio Impact Risk (0-100)" fieldKey="bioRisk" val={environment.bioRisk} setVal={v => setEnvironment({...environment, bioRisk: parseFloat(v) || 0})} type="number" />
                                </div>
                            </Accordion>
                            {/* 9. MONITORING & KPI FRAMEWORK (NEW) */}
                            <Accordion title="Monitoring & KPI" icon="üìà" isOpen={activeSection === 'kpi'} onClick={() => setActiveSection(activeSection === 'kpi' ? '' : 'kpi')}
                                extraAction={<button onClick={(e) => { e.stopPropagation(); setKpis([...kpis, {id: Date.now(), name: "", type: "Output", baselineYear: "2024", baselineVal: "", targetYear: "2029", targetVal: "", unit: "" }]); setActiveSection('kpi'); }} className="text-[10px] bg-indigo-100 text-indigo-700 px-2 py-1 rounded font-bold border border-indigo-200 hover:bg-indigo-200">+ Add KPI</button>}>
                                
                                <div className="p-2 bg-indigo-50 rounded mb-4 text-[10px] text-indigo-800 border border-indigo-200">
                                    <strong>Logical Framework:</strong> Ubah narasi menjadi target terukur! Tentukan Baseline vs Target.
                                </div>

                                {kpis.length === 0 && <p className="text-xs text-slate-400 italic text-center py-4">Belum ada KPI. Tambahkan indikator pencapaian.</p>}
                                
                                {kpis.map((kpi, idx) => (
                                    <div key={kpi.id} className="mb-3 p-3 border border-slate-200 rounded bg-slate-50 relative">
                                        <button onClick={()=>setKpis(kpis.filter(x=>x.id!==kpi.id))} className="absolute top-1 right-2 text-slate-300 hover:text-red-500 font-bold">√ó</button>
                                        
                                        <Input label="Indicator Name" val={kpi.name} setVal={v=>{const n=[...kpis]; n[idx].name=v; setKpis(n)}} placeholder="e.g. Volume Ekspor Kopi" />
                                        
                                        <div className="flex gap-2 mb-2">
                                            <div className="w-1/2">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase">Type</label>
                                                <select className="w-full border p-1 rounded text-xs bg-white focus:border-blue-500 outline-none" value={kpi.type} onChange={e=>{const n=[...kpis]; n[idx].type=e.target.value; setKpis(n)}}>
                                                    <option value="Output">Output (Direct Product)</option>
                                                    <option value="Outcome">Outcome (Short-term Effect)</option>
                                                    <option value="Impact">Impact (Long-term Change)</option>
                                                </select>
                                            </div>
                                            <div className="w-1/2">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase">Unit/Satuan</label>
                                                <input className="w-full border p-1 rounded text-xs focus:border-blue-500 outline-none" value={kpi.unit||""} onChange={e=>{const n=[...kpis]; n[idx].unit=e.target.value; setKpis(n)}} placeholder="e.g. Ton, %, USD" />
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-2 mt-2 pt-2 border-t border-slate-200">
                                            <div>
                                                <label className="text-[9px] font-bold text-slate-400 uppercase">Baseline</label>
                                                <div className="flex gap-1">
                                                    <input className="w-1/2 border p-1 rounded text-xs focus:border-blue-500 outline-none" value={kpi.baselineYear||""} onChange={e=>{const n=[...kpis]; n[idx].baselineYear=e.target.value; setKpis(n)}} placeholder="Year" />
                                                    <input type="number" className="w-1/2 border p-1 rounded text-xs focus:border-blue-500 outline-none" value={kpi.baselineVal||""} onChange={e=>{const n=[...kpis]; n[idx].baselineVal=e.target.value; setKpis(n)}} placeholder="Value" />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="text-[9px] font-bold text-terracotta-500 uppercase">Target</label>
                                                <div className="flex gap-1">
                                                    <input className="w-1/2 border p-1 rounded text-xs focus:border-blue-500 outline-none border-terracotta-200" value={kpi.targetYear||""} onChange={e=>{const n=[...kpis]; n[idx].targetYear=e.target.value; setKpis(n)}} placeholder="Year" />
                                                    <input type="number" className="w-1/2 border p-1 rounded text-xs focus:border-blue-500 outline-none border-terracotta-200" value={kpi.targetVal||""} onChange={e=>{const n=[...kpis]; n[idx].targetVal=e.target.value; setKpis(n)}} placeholder="Value" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </Accordion>

                        </div>
                    </div>

                    {/* RIGHT PREVIEW (REPORT) */}
                    {/* UBAH BARIS INI (Tambahkan print:w-full print:overflow-visible print:absolute print:top-0 print:left-0) */}
                    <div className="w-8/12 bg-slate-200/50 p-8 overflow-y-auto relative print:w-full print:overflow-visible print:absolute print:top-0 print:left-0 print:bg-white print:p-0">
                        <div className="absolute top-4 right-8 flex gap-2 no-print z-20">
                            {/* Tombol AI */}
                            <button onClick={handleAI} disabled={aiLoading} className={`px-4 py-2 rounded-full text-white text-xs font-bold shadow-lg flex items-center gap-2 ${aiLoading ? 'bg-slate-400' : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:shadow-xl transition-all'}`}>
                                <span>‚ú®</span> {aiLoading ? 'Analyzing...' : 'AI Exec Summary'}
                            </button>
                            
                            {/* Tombol Save DOC */}
                            <button onClick={exportToWord} className="bg-blue-800 text-white px-4 py-2 rounded shadow text-xs font-bold hover:bg-blue-700 transition-colors flex items-center gap-1">
                                <span>üìÑ</span> Save DOC
                            </button>

                            {/* Tombol Print PDF */}
                            <button onClick={() => window.print()} className="bg-navy-900 text-white px-4 py-2 rounded shadow text-xs font-bold hover:bg-navy-800 transition-colors">
                                Print PDF
                            </button>
                        </div>

                        <div ref={reportRef} className="report-paper max-w-5xl mx-auto p-12 text-slate-800 relative animate-fadeIn">
                            
                            {/* COVER HEADER */}
                            <div className="mb-10 border-b-4 border-navy-900 pb-6 flex justify-between items-end">
                                {/* Container Kiri: Gabungan Logo & Judul */}
                                <div className="flex items-start gap-6">
                                    
                                    {/* 1. LOGO (Hanya muncul jika ada) */}
                                    {logo && (
                                        <img src={logo} alt="Logo Daerah" className="h-24 w-auto object-contain" />
                                    )}

                                    {/* 2. JUDUL TEKS */}
                                    <div>
                                        {/* Badge Tipe Dokumen */}
                                        <span className="bg-terracotta-500 text-white px-2 py-1 text-[10px] font-bold uppercase tracking-widest rounded mb-2 inline-block">S3 Strategy Document</span>
                                        
                                        {/* Nama Daerah */}
                                        <h1 className="font-serif text-5xl font-bold text-navy-900 mt-2 leading-tight">{regionName || "Untitled Region"}</h1>
                                        
                                        {/* Sub-judul */}
                                        <div className="mt-4 text-sm text-slate-500 font-medium">Smart Specialization Strategy Roadmap ‚Ä¢ {governance.timeline || "Draft Period"}</div>
                                    </div>
                                </div>

                                {/* Container Kanan: Tahun (Tetap) */}
                                <div className="text-right hidden sm:block">
                                    <div className="text-4xl font-bold text-slate-200">2024</div>
                                </div>
                            </div>
                            
                            {/* AI ANALYSIS BLOCK */}
                            {aiAnalysis && (
                                <div className="mb-10 bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 p-8 rounded-xl relative shadow-sm">
                                    <h4 className="text-xs font-bold text-blue-600 uppercase mb-4 flex items-center gap-2"><span className="text-lg">‚ú®</span> Executive Summary (AI Generated)</h4>
                                    <div className="prose prose-sm max-w-none text-slate-700 font-serif leading-relaxed" dangerouslySetInnerHTML={{__html: aiAnalysis}}></div>
                                    <button onClick={()=>setAiAnalysis("")} className="absolute top-4 right-4 text-slate-400 hover:text-red-500 no-print">‚úï</button>
                                </div>
                            )}

                            {/* VISION */}
                            {governance.vision && (
                                <div className="mb-12 text-center px-10">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Strategic Vision</h4>
                                    <p className="font-serif text-2xl text-navy-800 italic leading-relaxed">"{governance.vision}"</p>
                                </div>
                                
                            )}
                            {(governance.coordIndex > 0 || governance.policyCoh > 0) && (
                                <div className="mb-12 px-10 page-break-avoid">
                                    <h3 className="section-title text-sm font-bold text-navy-900 mb-4 flex items-center gap-2 uppercase tracking-widest border-b pb-2">
                                    <span className="text-xl">üèõÔ∏è</span> Governance & Institutional Capacity</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {[
                                { label: "Coordination Index", val: governance.coordIndex || 0, color: "bg-blue-500", text: "text-blue-600" },
                                { label: "Policy Coherence", val: governance.policyCoh || 0, color: "bg-indigo-500", text: "text-indigo-600" },
                                { label: "PPP Readiness", val: governance.pppReady || 0, color: "bg-purple-500", text: "text-purple-600" },
                                { label: "Budget Absorption", val: governance.budgetAbs || 0, color: "bg-emerald-500", text: "text-emerald-600" }
                                        ].map((item, i) => (
                                <div key={i} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center relative overflow-hidden group hover:shadow-md transition-shadow">
                                <div className={`text-2xl font-bold mb-1 ${item.text}`}>{item.val}%</div>
                                <div className="text-[9px] text-slate-500 uppercase tracking-wider font-bold mb-3 h-6 flex items-center justify-center">
                                        {item.label}</div>

                        {/* Progress Bar Background */}
                                <div className="w-full bg-slate-100 rounded-full h-1.5">
                        {/* Progress Bar Fill */}
                                <div className={`${item.color} h-1.5 rounded-full transition-all duration-1000 ease-out`} style={{width: `${item.val}%`}}></div>
                                </div>
                                </div>
                         ))}
                    </div>
                 </div>
                        )}
                            {/* FINANCIAL LEVERAGE DASHBOARD */}
                            {(finance.fundingNeeded > 0) && (
                                <div className="mb-12 px-10 page-break-avoid animate-fadeIn">
                                    <h3 className="section-title text-sm font-bold text-navy-900 mb-4 flex items-center gap-2 uppercase tracking-widest border-b pb-2">
                                    <span className="text-xl">üí∞</span> Financial Leverage & Investment</h3>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                            <div className="text-[9px] text-slate-500 uppercase tracking-wider font-bold mb-1">Funding Needed</div>
                                            <div className="text-xl font-bold text-navy-800">{formatUSD(finance.fundingNeeded)}</div>
                                        </div>
                                        <div className="bg-red-50 p-4 rounded-xl border border-red-100 shadow-sm text-center">
                                            <div className="text-[9px] text-red-500 uppercase tracking-wider font-bold mb-1">Investment Gap</div>
                                            <div className="text-xl font-bold text-red-700">
                                                {formatUSD(Math.max(0, finance.fundingNeeded - (finance.publicInv + finance.privateInv)))}
                                            </div>
                                        </div>
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                            <div className="text-[9px] text-slate-500 uppercase tracking-wider font-bold mb-1">Pub vs Priv Ratio</div>
                                            <div className="text-xl font-bold text-indigo-700">
                                                {finance.publicInv === 0 && finance.privateInv === 0 ? "0:0" : 
                                                 finance.privateInv === 0 ? "100:0" : 
                                                 `1 : ${(finance.privateInv / (finance.publicInv || 1)).toFixed(1)}`}
                                            </div>
                                        </div>
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center">
                                            <div className="text-[9px] text-slate-500 uppercase tracking-wider font-bold mb-1">Blended Readiness</div>
                                            <div className="text-xl font-bold text-emerald-600">{finance.blendedReady}%</div>
                                        </div>
                                    </div>

                                    {/* Visualisasi Bar Persentase */}
                                    <div className="bg-white p-5 rounded-xl border border-slate-200 shadow-sm mt-2">
                                        <div className="flex justify-between text-[10px] mb-2 font-bold uppercase tracking-wider">
                                            <span className="text-blue-600">Public: {formatUSD(finance.publicInv)}</span>
                                            <span className="text-emerald-600">Private: {formatUSD(finance.privateInv)}</span>
                                            <span className="text-red-500">Gap: {formatUSD(Math.max(0, finance.fundingNeeded - (finance.publicInv + finance.privateInv)))}</span>
                                        </div>
                                        <div className="w-full flex h-4 rounded-full overflow-hidden bg-red-100 shadow-inner">
                                            <div className="bg-blue-500 transition-all duration-1000" style={{width: `${(finance.publicInv / finance.fundingNeeded) * 100}%`}}></div>
                                            <div className="bg-emerald-500 transition-all duration-1000" style={{width: `${(finance.privateInv / finance.fundingNeeded) * 100}%`}}></div>
                                        </div>
                                        <div className="mt-3 text-[10px] text-slate-500 text-center uppercase tracking-wider">
                                            Diversification Index: <span className="font-bold text-navy-800">{finance.divIndex}/100</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {/* SOCIAL & EQUITY DASHBOARD */}
                            {(equity.smePart > 0 || equity.ruralShare > 0) && (
                                <div className="mb-12 px-10 page-break-avoid animate-fadeIn">
                                    <h3 className="section-title text-sm font-bold text-navy-900 mb-4 flex items-center gap-2 uppercase tracking-widest border-b pb-2">
                                    <span className="text-xl">‚öñÔ∏è</span> Social & Equity Impact</h3>
                                    
                                    <div className="grid grid-cols-5 gap-3">
                                        {/* Gini Impact Card - Logika Warna: Minus itu bagus (Hijau), Plus itu buruk (Merah) */}
                                        <div className={`p-3 rounded-lg border shadow-sm text-center col-span-1 ${equity.giniImpact < 0 ? 'bg-emerald-50 border-emerald-200' : equity.giniImpact > 0 ? 'bg-red-50 border-red-200' : 'bg-slate-50 border-slate-200'}`}>
                                            <div className="text-[8px] uppercase font-bold text-slate-500 mb-1">Gini Ratio Impact</div>
                                            <div className={`text-xl font-bold ${equity.giniImpact < 0 ? 'text-emerald-700' : equity.giniImpact > 0 ? 'text-red-700' : 'text-slate-700'}`}>
                                                {equity.giniImpact > 0 ? '+' : ''}{equity.giniImpact}
                                            </div>
                                            <div className="text-[8px] text-slate-400 mt-1">{equity.giniImpact < 0 ? 'Inequality Reduced' : 'Needs Attention'}</div>
                                        </div>

                                        <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-center col-span-1">
                                            <div className="text-[8px] uppercase font-bold text-slate-500 mb-1">SME Integration</div>
                                            <div className="text-xl font-bold text-terracotta-600">{equity.smePart}%</div>
                                        </div>

                                        <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-center col-span-1">
                                            <div className="text-[8px] uppercase font-bold text-slate-500 mb-1">Rural Share</div>
                                            <div className="text-xl font-bold text-amber-600">{equity.ruralShare}%</div>
                                        </div>

                                        <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-center col-span-1">
                                            <div className="text-[8px] uppercase font-bold text-slate-500 mb-1">Youth Multiplier</div>
                                            <div className="text-xl font-bold text-blue-600">{equity.youthMult}x</div>
                                        </div>

                                        <div className="bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-center col-span-1">
                                            <div className="text-[8px] uppercase font-bold text-slate-500 mb-1">Gender Inclusion</div>
                                            <div className="text-xl font-bold text-purple-600">{equity.genderInc}%</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {/* ENVIRONMENT & RESILIENCE DASHBOARD */}
                            {(environment.climateVuln > 0 || environment.carbonInt > 0) && (
                                <div className="mb-12 px-10 page-break-avoid animate-fadeIn">
                                    <h3 className="section-title text-sm font-bold text-navy-900 mb-4 flex items-center gap-2 uppercase tracking-widest border-b pb-2">
                                    <span className="text-xl">üå±</span> Environment & Climate Resilience</h3>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {/* Climate Vulnerability */}
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center relative overflow-hidden">
                                            <div className="text-[9px] uppercase font-bold text-slate-500 mb-1">Climate Vuln. Index</div>
                                            <div className={`text-2xl font-bold ${environment.climateVuln > 70 ? 'text-red-600' : environment.climateVuln > 40 ? 'text-orange-500' : 'text-emerald-600'}`}>{environment.climateVuln}</div>
                                            <div className="w-full bg-slate-100 rounded-full h-1.5 mt-2">
                                                <div className={`${environment.climateVuln > 70 ? 'bg-red-500' : environment.climateVuln > 40 ? 'bg-orange-400' : 'bg-emerald-500'} h-1.5 rounded-full transition-all duration-1000`} style={{width: `${environment.climateVuln}%`}}></div>
                                            </div>
                                        </div>

                                        {/* Carbon Intensity */}
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center relative overflow-hidden">
                                            <div className="text-[9px] uppercase font-bold text-slate-500 mb-1">Carbon Intensity</div>
                                            <div className="text-2xl font-bold text-slate-700">{environment.carbonInt} <span className="text-xs font-normal text-slate-400">tCO‚ÇÇ</span></div>
                                            <div className="text-[8px] mt-1 text-slate-400 uppercase tracking-wider">Per USD 1M Output</div>
                                        </div>

                                        {/* Water Dependency Risk */}
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center relative overflow-hidden">
                                            <div className="text-[9px] uppercase font-bold text-slate-500 mb-1">Water Risk</div>
                                            <div className={`text-2xl font-bold ${environment.waterRisk > 70 ? 'text-red-600' : environment.waterRisk > 40 ? 'text-orange-500' : 'text-blue-500'}`}>{environment.waterRisk}</div>
                                            <div className="w-full bg-slate-100 rounded-full h-1.5 mt-2">
                                                <div className={`${environment.waterRisk > 70 ? 'bg-red-500' : environment.waterRisk > 40 ? 'bg-orange-400' : 'bg-blue-500'} h-1.5 rounded-full transition-all duration-1000`} style={{width: `${environment.waterRisk}%`}}></div>
                                            </div>
                                        </div>

                                        {/* Biodiversity Risk */}
                                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm text-center relative overflow-hidden">
                                            <div className="text-[9px] uppercase font-bold text-slate-500 mb-1">Biodiversity Risk</div>
                                            <div className={`text-2xl font-bold ${environment.bioRisk > 70 ? 'text-red-600' : environment.bioRisk > 40 ? 'text-orange-500' : 'text-emerald-600'}`}>{environment.bioRisk}</div>
                                            <div className="w-full bg-slate-100 rounded-full h-1.5 mt-2">
                                                <div className={`${environment.bioRisk > 70 ? 'bg-red-500' : environment.bioRisk > 40 ? 'bg-orange-400' : 'bg-emerald-500'} h-1.5 rounded-full transition-all duration-1000`} style={{width: `${environment.bioRisk}%`}}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {/* SECTORS & CHARTS */}
                            {sectors.length > 0 && (
                                <div className="mb-12 page-break">
                                    <h3 className="section-title text-xl font-bold text-navy-900 mb-6 flex items-center gap-3"><span className="w-8 h-1 bg-terracotta-500 block"></span>Priority Sectors & Analysis</h3>
                                    
                                    <div className="grid grid-cols-2 gap-8 mb-8 page-break-avoid">
                                        <div className="bg-white border rounded-lg p-4 shadow-sm">
                                            <h4 className="text-xs font-bold text-center mb-2">Location Quotient (LQ)</h4>
                                            <div className="h-56"><canvas ref={lqRef}></canvas></div>
                                        </div>
                                        <div className="bg-white border rounded-lg p-4 shadow-sm relative flex flex-col">
                                            <h4 className="text-xs font-bold text-center mb-2">Sector Potential Radar</h4>
                                            
                                            <div className="h-56 flex-1"><canvas ref={radarRef}></canvas></div>
                                            
                                            {/* --- SMART DISCLAIMER (TRANSPARENCY) --- */}
                                            {(!environment.climateVuln && !environment.waterRisk && !environment.bioRisk) ? (
                                                <div className="mt-3 bg-amber-50 text-amber-700 text-[9px] p-2 rounded border border-amber-200 text-center flex items-center justify-center gap-1 animate-fadeIn">
                                                    <span className="text-xs">‚ö†Ô∏è</span> 
                                                    <i><strong>Partial Data:</strong> Risk Composite & Inst. Support dimensions are based on limited available data.</i>
                                                </div>
                                            ) : (
                                                <div className="mt-3 bg-emerald-50 text-emerald-700 text-[9px] p-2 rounded border border-emerald-200 text-center flex items-center justify-center gap-1 animate-fadeIn">
                                                    <span className="text-xs">‚úÖ</span> 
                                                    <i><strong>Verified:</strong> Full ESG & Risk dimensions applied.</i>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="overflow-x-auto page-break-avoid">
                                        <table className="w-full text-sm text-left border rounded-lg overflow-hidden">
                                            <thead className="bg-navy-900 text-white uppercase text-xs">
                                                <tr>
                                                    <th className="p-3">Sector Name</th>
                                                    <th className="p-3 text-right">LQ Score</th>
                                                    <th className="p-3 text-right">Export</th>
                                                    <th className="p-3 bg-indigo-900 text-indigo-100 w-1/5">Transformation Pathway</th>
                                                    <th className="p-3 text-center bg-purple-900">Innovation Score</th>
                                                    <th className="p-3 text-center bg-emerald-900 text-emerald-100">Feasibility Index</th> 
                                                    <th className="p-3 text-center">TRL</th>
                                                    <th className="p-3">Strategic Rationale</th>
                                                    <th className="p-3 bg-blue-900 text-blue-100">Tech Focus</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100 border">{processedData.data.map(s => {
                                            const path = analyzePathway(s);
                                            const inno = calculateInnoScore(s); 
                                            const feas = calculateFeasibility(s);
                                            return (
                                                <tr key={s.id} className="hover:bg-slate-50">
                                                    <td className="p-3 font-bold text-navy-800">{s.name}</td>
                                                    <td className="p-3 text-right font-mono text-xs">{s.lq}</td>
                                                    <td className="p-3 text-right font-mono text-xs text-green-700 font-bold">{formatUSD(s.exportVal)}</td>
                                                    <td className="p-3"><div className={`text-[10px] font-bold px-2 py-1 rounded border mb-1 ${path.color} inline-block`}>{path.name}</div><div className="text-[9px] text-slate-500 leading-tight">{path.desc}</div>
                                                        <div className="flex gap-1 mt-1 opacity-70">
                                                            <span className="text-[8px] bg-slate-200 px-1 rounded" title="Value Added">VA:{s.valueAdd||0}</span>
                                                            <span className="text-[8px] bg-slate-200 px-1 rounded" title="Import Substitution">IS:{s.importSub||0}%</span>
                                                            <span className="text-[8px] bg-slate-200 px-1 rounded" title="GVC Position">GVC:{s.gvcPos||0}</span></div></td>
                                                    <td className="p-3 text-center"><div className={`text-[10px] font-bold px-2 py-1 rounded border ${inno.color} inline-block`}>{inno.score}/100 <br/> {inno.label}</div></td>
                                                    <td className="p-3 text-center"><div className={`text-[10px] font-bold px-2 py-1 rounded border ${feas.color} inline-block shadow-sm`}>{feas.score}/100 <br/> {feas.label}</div></td>
                                                    <td className="p-3 text-center font-mono text-xs">Level {s.trl || "-"}</td>
                                                    <td className="p-3 text-slate-600 text-xs italic">{s.rationale}</td>
                                                    <td className="p-3 text-blue-800 text-xs font-medium bg-blue-50">{s.tech || "-"}</td></tr>
                                             );
                                                 })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* SWOT MATRIX */}
                            {(swot.s || swot.w || swot.o || swot.t) && (
                                <div className="mb-12 page-break">
                                    <h3 className="section-title text-xl font-bold text-navy-900 mb-6 flex items-center gap-3"><span className="w-8 h-1 bg-terracotta-500 block"></span>SWOT Analysis</h3>
                                    <div className="grid grid-cols-2 gap-4 page-break-avoid">
                                        <div className="p-5 bg-blue-50 border border-blue-100 rounded-lg">
                                            <h4 className="font-bold text-blue-800 mb-2 uppercase text-xs">Strengths</h4>
                                            <p className="whitespace-pre-line text-sm text-slate-700">{swot.s || "-"}</p>
                                        </div>
                                        <div className="p-5 bg-orange-50 border border-orange-100 rounded-lg">
                                            <h4 className="font-bold text-orange-800 mb-2 uppercase text-xs">Weaknesses</h4>
                                            <p className="whitespace-pre-line text-sm text-slate-700">{swot.w || "-"}</p>
                                        </div>
                                        <div className="p-5 bg-green-50 border border-green-100 rounded-lg">
                                            <h4 className="font-bold text-green-800 mb-2 uppercase text-xs">Opportunities</h4>
                                            <p className="whitespace-pre-line text-sm text-slate-700">{swot.o || "-"}</p>
                                        </div>
                                        <div className="p-5 bg-red-50 border border-red-100 rounded-lg">
                                            <h4 className="font-bold text-red-800 mb-2 uppercase text-xs">Threats</h4>
                                            <p className="whitespace-pre-line text-sm text-slate-700">{swot.t || "-"}</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* STAKEHOLDERS & ACTION PLAN GRID */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12 page-break">
                                {/* Stakeholders */}
                                {stakeholders.length > 0 && (
                                    <div>
                                        <h3 className="section-title text-lg font-bold text-navy-900 mb-4 flex items-center gap-2"><span className="w-4 h-1 bg-terracotta-500 block"></span>Helix Actors</h3>
                                        <ul className="space-y-3">
                                            {stakeholders.map(st => (
                                                <li key={st.id} className="bg-white border p-3 rounded shadow-sm flex items-center gap-3">
                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold
                                                        ${st.role === 'Government' ? 'bg-navy-700' : st.role === 'Academic' ? 'bg-purple-600' : st.role === 'Business' ? 'bg-emerald-600' : 'bg-orange-500'}`}>
                                                        {st.role[0]}
                                                    </div>
                                                    <div>
                                                        <div className="font-bold text-sm text-navy-800">{st.name}</div>
                                                        <div className="text-xs text-slate-500">{st.role} ‚Ä¢ {st.task}</div>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                {/* Action Plan */}
                                {actionPlan.length > 0 && (
                                    <div>
                                        <h3 className="section-title text-lg font-bold text-navy-900 mb-4 flex items-center gap-2"><span className="w-4 h-1 bg-terracotta-500 block"></span>Strategic Roadmap</h3>
                                        <div className="relative border-l-2 border-slate-200 ml-3 space-y-6 pl-6 py-2">
                                            {actionPlan.sort((a,b)=>a.year - b.year).map(act => 
                                                /* --- UPDATE: TAMPILAN ROADMAP DENGAN SDG --- */
                                                (
                                                <div key={act.id} className="relative pl-6 pb-6 border-l-2 border-slate-200 last:border-0 last:pb-0">
                                                                <span className="absolute -left-[5px] top-1 w-2 h-2 rounded-full bg-terracotta-500 ring-4 ring-white"></span>
                                                                
                                                                <div className="flex justify-between items-start">
                                                                    <div>
                                                                        <div className="flex items-center gap-2 mb-1">
                                                                            <span className="text-xs font-bold text-terracotta-600 bg-terracotta-50 px-2 py-0.5 rounded">{act.year}</span>
                                                                            
                                                                            {act.sdg && (
                                                                                <span className={`text-[9px] text-white px-2 py-0.5 rounded-full font-bold uppercase ${SDG_OPTIONS.find(o=>o.code===act.sdg)?.color || 'bg-slate-500'}`}>
                                                                                    {act.sdg}
                                                                                </span>
                                                                            )}
                                                                        </div>
                                                                        <h4 className="font-bold text-sm text-navy-800 leading-tight">{act.activity}</h4>
                                                                        <div className="text-xs text-slate-500 mt-1 italic">Output: {act.output}</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                            {/* MONITORING & KPI DASHBOARD */}
                            {kpis.length > 0 && (
                                <div className="mb-12 page-break">
                                    <h3 className="section-title text-xl font-bold text-navy-900 mb-6 flex items-center gap-3"><span className="w-8 h-1 bg-indigo-500 block"></span>Monitoring & KPI Framework</h3>
                                    
                                    <div className="overflow-x-auto page-break-avoid">
                                        <table className="w-full text-sm text-left border rounded-lg overflow-hidden shadow-sm">
                                            <thead className="bg-navy-900 text-white uppercase text-xs">
                                                <tr>
                                                    <th className="p-3">Performance Indicator</th>
                                                    <th className="p-3 w-1/6">Level</th>
                                                    <th className="p-3 text-center w-1/5 bg-slate-800">Baseline</th>
                                                    <th className="p-3 text-center w-1/5 bg-terracotta-600">Target</th>
                                                    <th className="p-3 text-right">Growth / Change</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100 border">
                                                {kpis.map((kpi) => {
                                                    const base = parseFloat(kpi.baselineVal) || 0;
                                                    const tgt = parseFloat(kpi.targetVal) || 0;
                                                    let growth = "-";
                                                    
                                                    // Hitung Persentase Pertumbuhan otomatis
                                                    if (base > 0 && tgt > 0) {
                                                        const pct = ((tgt - base) / base * 100).toFixed(1);
                                                        growth = pct > 0 ? `+${pct}%` : `${pct}%`;
                                                    } else if (base === 0 && tgt > 0) {
                                                        growth = "New Target";
                                                    }

                                                    return (
                                                        <tr key={kpi.id} className="hover:bg-slate-50 bg-white">
                                                            <td className="p-3 font-bold text-navy-800">{kpi.name}</td>
                                                            <td className="p-3">
                                                                <span className={`text-[9px] font-bold px-2 py-1 rounded uppercase tracking-wider
                                                                    ${kpi.type === 'Impact' ? 'bg-purple-100 text-purple-700 border border-purple-200' : 
                                                                    kpi.type === 'Outcome' ? 'bg-blue-100 text-blue-700 border border-blue-200' : 'bg-slate-100 text-slate-700 border border-slate-200'}`}>
                                                                    {kpi.type}
                                                                </span>
                                                            </td>
                                                            <td className="p-3 text-center">
                                                                <div className="text-lg font-bold">{kpi.baselineVal} <span className="text-[10px] font-normal text-slate-500">{kpi.unit}</span></div>
                                                                <div className="text-[9px] text-slate-400">Tahun: {kpi.baselineYear}</div>
                                                            </td>
                                                            <td className="p-3 text-center bg-terracotta-50/30">
                                                                <div className="text-lg font-bold text-terracotta-700">{kpi.targetVal} <span className="text-[10px] font-normal text-terracotta-500/70">{kpi.unit}</span></div>
                                                                <div className="text-[9px] text-terracotta-400">Tahun: {kpi.targetYear}</div>
                                                            </td>
                                                            <td className="p-3 text-right font-mono font-bold text-emerald-600">{growth}</td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                            
                            {(signer.name || signer.title) && (
                                <div className="mt-20 flex justify-end page-break-avoid">
                                    <div className="text-center w-64">
                                        <div className="text-sm font-medium text-slate-500 mb-16">Disahkan di {regionName ? regionName.split(" ").pop() : "Tempat"}, {new Date().getFullYear()}</div>
                                        <div className="font-bold text-navy-900 border-b border-navy-900 pb-1 mb-1">{signer.name || "Nama Pejabat"}</div>
                                        <div className="text-xs uppercase tracking-widest text-slate-500">{signer.title || "Jabatan"}</div>
                                    </div>
                                </div>
                            )}

                            <div className="mt-16 pt-6 border-t flex justify-between text-[10px] text-slate-400 uppercase tracking-widest">
                                <span>S3 Builder Professional</span>
                                <span>Generated: {new Date().toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
